<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Ng·ªçc Lan">
    <meta name="theme-color" content="#db2777">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 180 180'><rect width='180' height='180' rx='40' fill='%23db2777'/><text x='50%25' y='55%25' dominant-baseline='middle' text-anchor='middle' font-family='sans-serif' font-weight='900' font-style='italic' font-size='80' fill='white'>NL</text><text x='50%25' y='80%25' dominant-baseline='middle' text-anchor='middle' font-family='sans-serif' font-weight='700' font-size='18' fill='rgba(255,255,255,0.8)'>NGOC LAN</text></svg>">
    <title>Ng·ªçc Lan - B√¨nh Thu·∫≠n</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root { --primary-pink: #db2777; --dark-pink: #9d174d; --bg-gradient: linear-gradient(135deg, #fff1f2 0%, #ffe4e6 100%); }
        body { font-family: -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--bg-gradient); user-select: none; -webkit-tap-highlight-color: transparent; color: #1f2937; margin: 0; }
        .glass-card { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); border: 1px solid rgba(251, 207, 232, 0.5); box-shadow: 0 8px 20px -5px rgba(219, 39, 119, 0.1); }
        .safe-top { padding-top: env(safe-area-inset-top); }
        .btn-pink { background: linear-gradient(to right, #ec4899, #db2777); transition: all 0.2s ease; }
        .btn-pink:active { transform: scale(0.96); filter: brightness(1.1); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .animate-up { animation: slideUp 0.4s ease-out forwards; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const Icons = {
            Plus: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><path d="M12 5v14M5 12h14"/></svg>,
            Trash: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/></svg>,
            Send: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/></svg>,
            Save: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/></svg>,
            Settings: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1-2-2 2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
        };

        function App() {
            const [items, setItems] = useState([]);
            const [customer, setCustomer] = useState('Kh√°ch l·∫ª');
            const [customerNote, setCustomerNote] = useState('');
            const [form, setForm] = useState({ name: '', qty: 1, price: '', promo: '' });
            const [sheetUrl, setSheetUrl] = useState(localStorage.getItem('POS_SHEET_NL') || '');
            const [showSettings, setShowSettings] = useState(false);
            const [notif, setNotif] = useState(null);
            const receiptRef = useRef(null);

            const showNotif = (msg) => { setNotif(msg); setTimeout(() => setNotif(null), 3000); }

            const addItem = () => {
                if (!form.name || !form.price) return;
                
                let originalPrice = Number(form.price);
                let finalPrice = originalPrice;
                let discountText = "";

                if (form.promo.includes('%')) {
                    const match = form.promo.match(/(\d+(?:\.\d+)?)%/);
                    if (match) {
                        const percent = parseFloat(match[1]);
                        finalPrice = originalPrice * (1 - percent / 100);
                        discountText = `(Gi·∫£m ${percent}%)`;
                    }
                }

                const newItem = {
                    id: Date.now(),
                    name: form.name,
                    qty: Number(form.qty),
                    originalPrice: originalPrice,
                    price: finalPrice,
                    promo: form.promo,
                    discountText: discountText
                };

                setItems([newItem, ...items]);
                setForm({ name: '', qty: 1, price: '', promo: '' });
                if (window.navigator.vibrate) window.navigator.vibrate(50);
            };

            const total = items.reduce((s, i) => s + (i.price * i.qty), 0);

            const handleZalo = async () => {
                if (items.length === 0) return;
                try {
                    const canvas = await html2canvas(receiptRef.current, { scale: 3, backgroundColor: '#ffffff' });
                    const blob = await new Promise(res => canvas.toBlob(res, 'image/png'));
                    const file = new File([blob], `DonHang_NgocLan.png`, { type: 'image/png' });
                    if (navigator.share && navigator.canShare && navigator.canShare({ files: [file] })) {
                        await navigator.share({ files: [file], title: 'G·ª≠i ƒë∆°n h√†ng Ng·ªçc Lan' });
                    } else {
                        const link = document.createElement('a'); link.href = canvas.toDataURL(); link.download = `DonHang_NgocLan.png`; link.click();
                        showNotif("ƒê√£ l∆∞u ·∫£nh v√†o m√°y!"); setTimeout(() => window.location.href = "zalo://", 1000);
                    }
                } catch (e) { showNotif("L·ªói t·∫°o ·∫£nh!"); }
            };

            const saveSheet = async () => {
                if (!sheetUrl) return setShowSettings(true);
                try {
                    await fetch(sheetUrl, { method: 'POST', mode: 'no-cors', body: JSON.stringify({ time: new Date().toLocaleString('vi-VN'), customer, note: customerNote, total, items: items.map(i => `${i.name}(x${i.qty})`).join(', ') }) });
                    showNotif("‚úÖ ƒê√£ l∆∞u v√†o h·ªá th·ªëng!");
                } catch (e) { showNotif("L·ªói k·∫øt n·ªëi!"); }
            };

            return (
                <div className="flex flex-col h-screen max-w-md mx-auto overflow-hidden relative">
                    {notif && <div className="fixed top-24 left-1/2 -translate-x-1/2 z-[100] bg-rose-600 text-white text-[11px] font-bold px-6 py-2.5 rounded-full shadow-2xl animate-bounce">{notif}</div>}
                    
                    <div className="safe-top bg-gradient-to-br from-pink-500 to-rose-600 text-white px-6 pb-6 rounded-b-[2.5rem] shadow-xl flex justify-between items-end h-36">
                        <div className="animate-up">
                            <h1 className="text-2xl font-black uppercase italic tracking-tighter">NG·ªåC LAN</h1>
                            <p className="text-[10px] font-bold tracking-[0.2em] opacity-80 uppercase">B√¨nh Thu·∫≠n</p>
                        </div>
                        <button onClick={() => setShowSettings(true)} className="p-3 bg-white/20 rounded-2xl border border-white/30"><Icons.Settings /></button>
                    </div>

                    <div className="flex-1 overflow-y-auto px-5 py-6 space-y-5 no-scrollbar">
                        <div className="glass-card p-4 rounded-3xl space-y-3 animate-up">
                            <input className="w-full text-lg font-black text-rose-700 bg-transparent outline-none border-b border-rose-100 pb-1" value={customer} onChange={(e) => setCustomer(e.target.value)} placeholder="T√™n kh√°ch h√†ng..."/>
                            <input className="w-full text-[11px] italic text-rose-300 bg-transparent outline-none" value={customerNote} onChange={(e) => setCustomerNote(e.target.value)} placeholder="SƒêT, ƒë·ªãa ch·ªâ giao h√†ng..."/>
                        </div>

                        <div className="glass-card p-5 rounded-[2rem] space-y-4 animate-up">
                            <input className="w-full p-4 bg-rose-50/50 rounded-2xl text-sm font-bold outline-none border border-transparent focus:border-rose-200 text-rose-900" placeholder="T√™n h√†ng h√≥a..." value={form.name} onChange={(e) => setForm({...form, name: e.target.value})}/>
                            <input className="w-full p-3 bg-rose-50/30 rounded-xl text-[10px] italic outline-none border border-transparent focus:border-rose-100" placeholder="Ghi ch√∫ (Nh·∫≠p % ƒë·ªÉ gi·∫£m gi√°)..." value={form.promo} onChange={(e) => setForm({...form, promo: e.target.value})}/>
                            
                            <div className="flex gap-2 items-center">
                                <div className="flex-[7] relative">
                                    <input 
                                        type="number" 
                                        inputMode="numeric"
                                        className="w-full p-4 bg-rose-50 rounded-2xl font-black text-rose-700 outline-none border-2 border-transparent focus:border-rose-200 text-lg" 
                                        placeholder="Gi√° b√°n" 
                                        value={form.price} 
                                        onChange={(e) => setForm({...form, price: e.target.value})}
                                    />
                                    <span className="absolute right-4 top-1/2 -translate-y-1/2 text-[10px] font-bold text-rose-300">ƒë</span>
                                </div>
                                <div className="flex-[3]">
                                    <input 
                                        type="number" 
                                        inputMode="numeric"
                                        className="w-full p-4 bg-rose-50 rounded-2xl text-center font-black text-rose-700 outline-none border-2 border-transparent focus:border-rose-200 text-lg" 
                                        placeholder="SL"
                                        value={form.qty} 
                                        onChange={(e) => setForm({...form, qty: e.target.value})}
                                    />
                                </div>
                            </div>

                            <button onClick={addItem} className="w-full btn-pink text-white py-4 rounded-2xl shadow-lg shadow-rose-200 flex items-center justify-center gap-3 font-black text-xs uppercase tracking-widest">
                                <Icons.Plus /> Th√™m V√†o ƒê∆°n
                            </button>
                        </div>

                        <div className="space-y-3 pb-36">
                            {items.length === 0 ? <div className="text-center py-10 opacity-20 font-bold uppercase text-xs tracking-widest text-rose-300">ƒê∆°n h√†ng tr·ªëng</div> : items.map(item => (
                                <div key={item.id} className="glass-card p-4 rounded-2xl flex justify-between items-center animate-up border-l-4 border-rose-400">
                                    <div className="flex-1">
                                        <h4 className="font-bold text-rose-900 text-sm uppercase">{item.name}</h4>
                                        <div className="flex flex-wrap items-center gap-x-2">
                                            <span className="text-[10px] font-bold text-rose-300">
                                                {item.qty} x {item.originalPrice.toLocaleString()}ƒë
                                            </span>
                                            {item.discountText && (
                                                <span className="text-[10px] text-red-500 font-black italic">{item.discountText}</span>
                                            )}
                                        </div>
                                        {item.promo && <p className="text-[9px] text-rose-400 italic mt-1 leading-none">{item.promo}</p>}
                                    </div>
                                    <div className="text-right flex items-center gap-4">
                                        <div className="font-black text-rose-800 text-base">{(item.qty * item.price).toLocaleString()}</div>
                                        <button onClick={() => setItems(items.filter(i => i.id !== item.id))} className="text-rose-200"><Icons.Trash /></button>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>

                    <div className="absolute bottom-0 left-0 right-0 bg-white/95 backdrop-blur-xl px-6 pt-5 pb-8 border-t border-rose-50 rounded-t-[2.5rem] shadow-2xl">
                        <div className="flex justify-between items-end mb-4 px-2">
                            <span className="text-[10px] font-black text-rose-300 uppercase tracking-widest leading-none mb-1">Th√†nh ti·ªÅn</span>
                            <span className="text-3xl font-black text-rose-600 italic leading-none">{total.toLocaleString()}ƒë</span>
                        </div>
                        <div className="grid grid-cols-2 gap-3">
                            <button onClick={saveSheet} className="flex items-center justify-center gap-2 bg-rose-50 text-rose-400 font-black py-4 rounded-2xl text-[10px] uppercase"><Icons.Save /> L∆∞u File</button>
                            <button onClick={handleZalo} className="flex items-center justify-center gap-2 btn-pink text-white font-black py-4 rounded-2xl text-[10px] uppercase shadow-lg shadow-rose-200"><Icons.Send /> G·ª≠i Zalo</button>
                        </div>
                    </div>

                    {showSettings && (
                        <div className="fixed inset-0 z-[120] bg-rose-900/40 backdrop-blur-sm flex items-end">
                            <div className="bg-white w-full p-8 rounded-t-[3rem] animate-up shadow-2xl">
                                <h3 className="font-black text-rose-700 uppercase italic mb-4">K·∫øt n·ªëi D·ªØ li·ªáu</h3>
                                <textarea className="w-full p-4 bg-rose-50 rounded-2xl text-[10px] h-32 outline-none border border-rose-100" value={sheetUrl} onChange={(e) => { setSheetUrl(e.target.value); localStorage.setItem('POS_SHEET_NL', e.target.value); }} placeholder="D√°n link App Script c·ªßa b·∫°n t·∫°i ƒë√¢y..."/>
                                <button onClick={() => setShowSettings(false)} className="w-full mt-6 btn-pink text-white font-black py-4 rounded-2xl">L∆ØU C√ÄI ƒê·∫∂T</button>
                            </div>
                        </div>
                    )}

                    <div className="fixed -left-[5000px]">
                        <div ref={receiptRef} className="w-[700px] bg-white text-black font-sans p-16">
                            <div className="text-center mb-12">
                                <h1 className="text-5xl font-black uppercase tracking-[0.2em] text-rose-600 mb-2">ƒê∆†N H√ÄNG</h1>
                                <div className="flex items-center justify-center gap-4">
                                    <div className="h-0.5 w-20 bg-rose-200"></div>
                                    <span className="text-xs font-black uppercase tracking-[0.4em] text-rose-300">NG·ªåC LAN</span>
                                    <div className="h-0.5 w-20 bg-rose-200"></div>
                                </div>
                                <p className="text-[11px] font-bold opacity-30 mt-6 tracking-widest italic">Th·ªùi gian: {new Date().toLocaleString('vi-VN')}</p>
                            </div>
                            
                            <div className="mb-12 bg-rose-50 p-8 rounded-[2rem] border-l-[12px] border-rose-500">
                                <div className="text-[11px] font-black uppercase text-rose-400 mb-1 tracking-widest">Kh√°ch h√†ng:</div>
                                <div className="text-3xl font-black uppercase text-rose-900">{customer}</div>
                                {customerNote && <div className="text-sm font-bold text-rose-700 mt-2 italic">üìå {customerNote}</div>}
                            </div>

                            <div className="mb-14 px-2">
                                <div className="flex border-b-4 border-rose-600 pb-4 text-[12px] font-black uppercase tracking-wider text-rose-400">
                                    <div className="flex-1">H√†ng h√≥a</div>
                                    <div className="w-24 text-center">S·ªë l∆∞·ª£ng</div>
                                    <div className="w-32 text-right">Th√†nh ti·ªÅn</div>
                                </div>
                                {items.map(item => (
                                    <div key={item.id} className="flex py-8 border-b-2 border-dashed border-rose-100 items-center">
                                        <div className="flex-1">
                                            <div className="text-2xl font-black uppercase text-rose-900 leading-tight">{item.name}</div>
                                            <div className="flex items-center gap-3 mt-1">
                                                <span className={`${item.discountText ? 'line-through text-gray-400 text-sm' : 'text-rose-500 font-bold text-lg'}`}>
                                                    {item.originalPrice.toLocaleString()}ƒë
                                                </span>
                                                {item.discountText && (
                                                    <span className="text-rose-600 font-black text-lg">
                                                        {item.price.toLocaleString()}ƒë {item.discountText}
                                                    </span>
                                                )}
                                            </div>
                                            {item.promo && <div className="text-[11px] font-bold text-rose-400 italic mt-2">* {item.promo}</div>}
                                        </div>
                                        <div className="w-24 flex justify-center">
                                            <div className="w-16 h-16 rounded-full border-4 border-rose-500 flex items-center justify-center text-3xl font-black text-rose-600 italic bg-white shadow-lg">{item.qty}</div>
                                        </div>
                                        <div className="w-32 text-right text-2xl font-black text-rose-900">{(item.qty * item.price).toLocaleString()}</div>
                                    </div>
                                ))}
                            </div>

                            <div className="bg-rose-600 text-white p-10 rounded-[2.5rem] flex justify-between items-center shadow-2xl">
                                <div>
                                    <div className="text-[11px] font-black uppercase tracking-[0.3em] opacity-70 mb-1">T·ªïng c·ªông ƒë∆°n h√†ng:</div>
                                    <div className="text-6xl font-black italic tracking-tighter">{total.toLocaleString()}</div>
                                </div>
                                <div className="text-right">
                                    <div className="text-2xl font-black italic opacity-60">VNƒê</div>
                                </div>
                            </div>
                            
                            <div className="mt-20 text-center opacity-40">
                                <p className="text-[12px] font-black uppercase tracking-[0.6em] text-rose-800">C·∫£m ∆°n qu√Ω kh√°ch</p>
                                <p className="text-[10px] font-bold italic mt-2">NG·ªåC LAN - B√¨nh Thu·∫≠n</p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
